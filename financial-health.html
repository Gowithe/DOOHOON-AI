<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Financial Health - Stock Analyzer</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: radial-gradient(circle at 30% 20%, rgba(255,215,0,0.12), transparent 65%),
                  radial-gradient(circle at 80% 80%, rgba(218,165,32,0.08), transparent 60%),
                  #0a0a0a;
      color: #fff;
      font-family: 'Poppins', sans-serif;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 1300px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
    }

    h1 {
      color: #ffd700;
      font-size: 2.8em;
      margin-bottom: 8px;
      background: linear-gradient(135deg, #ffd700 0%, #ffed4e 50%, #ffd700 100%);
      background-size: 200% auto;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: shimmer 3s linear infinite;
    }

    @keyframes shimmer {
      0% { background-position: 0% center; }
      100% { background-position: 200% center; }
    }

    .subtitle {
      color: #c9a136;
      font-size: 1.05em;
      margin-bottom: 20px;
    }

    .api-info {
      background: rgba(100, 150, 255, 0.15);
      border: 2px solid rgba(100, 150, 255, 0.4);
      color: #87ceeb;
      padding: 12px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      text-align: center;
      font-size: 0.9em;
      display: none;
    }

    .demo-alert {
      background: rgba(255, 193, 7, 0.15);
      border: 2px solid rgba(255, 193, 7, 0.5);
      color: #ffc107;
      padding: 12px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: none;
      text-align: center;
      font-size: 0.95em;
    }

    .api-status {
      background: rgba(34, 197, 94, 0.15);
      border: 2px solid rgba(34, 197, 94, 0.4);
      color: #4ade80;
      padding: 12px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: none;
      text-align: center;
      font-size: 0.9em;
      font-weight: 600;
    }

    .search-section {
      max-width: 750px;
      margin: 0 auto 40px;
    }

    .search-wrapper {
      background: rgba(255,255,255,0.04);
      backdrop-filter: blur(20px);
      border: 2px solid rgba(255,215,0,0.2);
      border-radius: 16px;
      padding: 12px;
      display: flex;
      gap: 12px;
      align-items: center;
      transition: all 0.3s ease;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }

    .search-wrapper:focus-within {
      border-color: rgba(255,215,0,0.5);
      box-shadow: 0 8px 40px rgba(255,215,0,0.2);
    }

    input {
      flex: 1;
      padding: 16px 20px;
      border-radius: 12px;
      border: none;
      background: transparent;
      color: #fff;
      font-size: 1em;
      font-family: 'Poppins', sans-serif;
      outline: none;
      font-weight: 500;
    }

    input::placeholder {
      color: rgba(255,255,255,0.4);
    }

    button {
      padding: 16px 32px;
      background: linear-gradient(135deg, #ffd700, #daa520);
      border: none;
      border-radius: 12px;
      color: #000;
      font-weight: 700;
      font-size: 1em;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      box-shadow: 0 4px 15px rgba(255,215,0,0.3);
      font-family: 'Poppins', sans-serif;
    }

    button:hover {
      transform: translateY(-3px);
      background: linear-gradient(135deg, #ffec7f, #ffb400);
      box-shadow: 0 6px 25px rgba(255,215,0,0.5);
    }

    button:active {
      transform: translateY(-1px);
    }

    .quick-picks {
      margin-top: 18px;
      text-align: center;
      color: #888;
      font-size: 0.9em;
    }

    .quick-picks-label {
      display: block;
      margin-bottom: 12px;
      color: #aaa;
    }

    .quick-picks span {
      display: inline-block;
      margin: 4px 6px;
      padding: 8px 14px;
      background: rgba(255,215,0,0.08);
      border: 1px solid rgba(255,215,0,0.25);
      border-radius: 8px;
      color: #daa520;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      font-size: 0.9em;
    }

    .quick-picks span:hover {
      background: rgba(255,215,0,0.15);
      border-color: rgba(255,215,0,0.4);
      color: #ffd700;
      transform: translateY(-2px);
    }

    .loading {
      text-align: center;
      padding: 80px 20px;
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .loading-spinner {
      display: inline-block;
      width: 60px;
      height: 60px;
      border: 5px solid rgba(255,215,0,0.2);
      border-top-color: #ffd700;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-text {
      color: #ffd700;
      font-size: 1.1em;
      font-weight: 500;
    }

    .error {
      max-width: 650px;
      margin: 40px auto;
      background: rgba(255,50,50,0.12);
      border: 2px solid rgba(255,50,50,0.4);
      border-radius: 12px;
      padding: 24px;
      color: #ff6b6b;
      display: none;
      text-align: center;
      font-size: 1.05em;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .results-wrapper {
      display: none;
      animation: fadeIn 0.4s ease;
    }

    .result-header {
      background: linear-gradient(135deg, rgba(255,215,0,0.15), rgba(218,165,32,0.08));
      border: 2px solid rgba(255,215,0,0.3);
      border-radius: 16px;
      padding: 32px;
      margin-bottom: 35px;
      text-align: center;
    }

    .result-symbol {
      font-size: 2.8em;
      color: #ffd700;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .last-updated {
      color: #888;
      font-size: 0.9em;
      margin-top: 15px;
    }

    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 24px;
      margin-bottom: 40px;
    }

    .metric-card {
      background: linear-gradient(135deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01));
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 14px;
      padding: 28px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .metric-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, rgba(255,215,0,0.3), transparent);
    }

    .metric-card:hover {
      background: linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
      border-color: rgba(255,215,0,0.2);
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.4);
    }

    .card-title {
      font-size: 1.15em;
      font-weight: 700;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .status-light {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      font-weight: 700;
      font-size: 0.75em;
      text-shadow: 0 2px 4px rgba(0,0,0,0.5);
      box-shadow: 0 0 10px currentColor;
    }

    .status-good {
      background: #22c55e;
      color: #fff;
    }

    .status-neutral {
      background: #eab308;
      color: #000;
    }

    .status-poor {
      background: #ef4444;
      color: #fff;
    }

    .status-gray {
      background: #6b7280;
      color: #fff;
    }

    .card-value {
      font-size: 1.7em;
      font-weight: 700;
      margin-bottom: 12px;
      color: #ffd700;
    }

    .card-reason {
      font-size: 0.92em;
      line-height: 1.5;
      color: #b3b3b3;
      border-top: 1px solid rgba(255,215,0,0.1);
      padding-top: 14px;
      margin-top: 14px;
    }

    .card-reason strong {
      color: #e0e0e0;
    }

    .section-title {
      font-size: 1.3em;
      font-weight: 700;
      margin: 40px 0 25px 0;
      color: #ffd700;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .footer-note {
      background: rgba(255,193,7,0.08);
      border: 1px solid rgba(255,193,7,0.2);
      border-radius: 10px;
      padding: 20px;
      margin-top: 40px;
      font-size: 0.92em;
      color: #c9a136;
      line-height: 1.6;
    }

    .footer-note strong {
      color: #ffd700;
    }

    .overall-score-section {
      background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(218,165,32,0.1));
      border: 2px solid rgba(255,215,0,0.4);
      border-radius: 20px;
      padding: 40px;
      margin-bottom: 40px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .overall-score-section::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,215,0,0.1) 0%, transparent 70%);
      animation: glow 4s ease-in-out infinite;
    }

    @keyframes glow {
      0%, 100% { transform: scale(1); opacity: 0.8; }
      50% { transform: scale(1.1); opacity: 1; }
    }

    .overall-score-content {
      position: relative;
      z-index: 1;
    }

    .score-label {
      font-size: 1.3em;
      color: #ffd700;
      font-weight: 700;
      margin-bottom: 20px;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .score-container {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 30px;
      flex-wrap: wrap;
      margin-bottom: 25px;
    }

    .score-circle {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 140px;
      height: 140px;
      border-radius: 50%;
      font-size: 3em;
      font-weight: 900;
      position: relative;
      box-shadow: 0 0 30px rgba(255,215,0,0.3), inset 0 0 20px rgba(255,215,0,0.1);
    }

    .score-circle.score-excellent {
      background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
      color: #fff;
      border: 3px solid #22c55e;
    }

    .score-circle.score-good {
      background: linear-gradient(135deg, #eab308 0%, #ca8a04 100%);
      color: #000;
      border: 3px solid #eab308;
    }

    .score-circle.score-average {
      background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
      color: #fff;
      border: 3px solid #f97316;
    }

    .score-circle.score-poor {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: #fff;
      border: 3px solid #ef4444;
    }

    .score-sub-label {
      font-size: 0.7em;
      font-weight: 600;
      margin-top: 8px;
      opacity: 0.95;
    }

    .score-breakdown {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 25px;
    }

    .score-item {
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,215,0,0.15);
      border-radius: 10px;
      padding: 12px 15px;
      font-size: 0.9em;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .score-item-name {
      color: #b3b3b3;
      font-weight: 500;
    }

    .score-item-value {
      color: #ffd700;
      font-weight: 700;
      font-size: 1.1em;
    }

    .recommendation-section {
      background: rgba(255,215,0,0.08);
      border: 2px solid rgba(255,215,0,0.2);
      border-radius: 15px;
      padding: 25px;
      margin-top: 25px;
    }

    .recommendation-title {
      font-size: 1.1em;
      color: #ffd700;
      font-weight: 700;
      margin-bottom: 12px;
    }

    .recommendation-text {
      color: #d9d9d9;
      font-size: 0.95em;
      line-height: 1.6;
    }

    .recommendation-text strong {
      color: #ffd700;
    }

    .comparison-container {
      margin-top: 30px;
      padding: 20px;
      background: rgba(255,255,255,0.02);
      border-radius: 12px;
    }

    .comparison-title {
      font-size: 1em;
      color: #c9a136;
      font-weight: 700;
      margin-bottom: 15px;
    }

    .comparison-bars {
      display: flex;
      gap: 20px;
      flex-direction: column;
    }

    .bar-item {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .bar-label {
      min-width: 120px;
      font-size: 0.9em;
      color: #aaa;
    }

    .bar-background {
      flex: 1;
      height: 24px;
      background: rgba(255,255,255,0.08);
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid rgba(255,215,0,0.2);
    }

    .bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #ffd700, #ffed4e);
      border-radius: 12px;
      transition: width 0.6s ease;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding-right: 8px;
      font-size: 0.8em;
      font-weight: 700;
      color: #000;
    }

    .health-badge {
      display: inline-block;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 700;
      font-size: 0.85em;
      margin-top: 10px;
    }

    .health-badge.excellent {
      background: rgba(34, 197, 94, 0.2);
      color: #4ade80;
      border: 1px solid rgba(34, 197, 94, 0.4);
    }

    .health-badge.good {
      background: rgba(234, 179, 8, 0.2);
      color: #facc15;
      border: 1px solid rgba(234, 179, 8, 0.4);
    }

    .health-badge.average {
      background: rgba(249, 115, 22, 0.2);
      color: #fb923c;
      border: 1px solid rgba(249, 115, 22, 0.4);
    }

    .health-badge.poor {
      background: rgba(239, 68, 68, 0.2);
      color: #fca5a5;
      border: 1px solid rgba(239, 68, 68, 0.4);
    }

    .compare-section {
      background: rgba(255,215,0,0.05);
      border: 1px solid rgba(255,215,0,0.15);
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
    }

    .compare-title {
      font-size: 1em;
      color: #c9a136;
      font-weight: 700;
      margin-bottom: 15px;
    }

    .compare-buttons {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .compare-btn {
      padding: 10px 18px;
      background: rgba(255,215,0,0.1);
      border: 1px solid rgba(255,215,0,0.3);
      border-radius: 8px;
      color: #ffd700;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9em;
      transition: all 0.3s ease;
    }

    .compare-btn:hover {
      background: rgba(255,215,0,0.2);
      border-color: rgba(255,215,0,0.5);
      transform: translateY(-2px);
    }

    .export-section {
      display: flex;
      gap: 12px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .export-btn {
      padding: 12px 20px;
      background: rgba(100, 200, 255, 0.15);
      border: 1px solid rgba(100, 200, 255, 0.3);
      border-radius: 8px;
      color: #87ceeb;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.95em;
      transition: all 0.3s ease;
      font-family: 'Poppins', sans-serif;
    }

    .export-btn:hover {
      background: rgba(100, 200, 255, 0.25);
      border-color: rgba(100, 200, 255, 0.5);
      transform: translateY(-2px);
    }

    .features-section {
      background: linear-gradient(135deg, rgba(255,215,0,0.08), rgba(218,165,32,0.04));
      border: 1px solid rgba(255,215,0,0.2);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 30px;
      display: none;
    }

    .features-section.show {
      display: block;
      animation: slideDown 0.4s ease;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
    }

    .feature-item {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,215,0,0.15);
      border-radius: 10px;
      padding: 18px;
      display: flex;
      gap: 15px;
      transition: all 0.3s ease;
    }

    .feature-item:hover {
      background: rgba(255,255,255,0.06);
      border-color: rgba(255,215,0,0.3);
      transform: translateY(-3px);
    }

    .feature-icon {
      font-size: 2em;
      min-width: 50px;
    }

    .feature-content {
      flex: 1;
    }

    .feature-title {
      font-size: 0.95em;
      font-weight: 700;
      color: #ffd700;
      margin-bottom: 5px;
    }

    .feature-desc {
      font-size: 0.85em;
      color: #b3b3b3;
      line-height: 1.5;
    }

    @media (max-width: 768px) {
      .cards-grid {
        grid-template-columns: 1fr;
      }

      h1 {
        font-size: 2em;
      }

      .result-symbol {
        font-size: 2em;
      }

      .search-wrapper {
        flex-direction: column;
      }

      button {
        width: 100%;
      }

      .score-container {
        flex-direction: column;
      }

      .features-grid {
        grid-template-columns: 1fr;
      }

      .score-circle {
        width: 100px;
        height: 100px;
        font-size: 2.2em;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üí∞ ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</h1>
      <p class="subtitle">‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏´‡∏∏‡πâ‡∏ô</p>
      <div class="api-status" id="apiStatus">
        ‚úÖ API Keys ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô - ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á
      </div>
      <div class="api-info" id="apiInfo">
        ‚ÑπÔ∏è ‡πÉ‡∏ä‡πâ‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞ - ‡πÉ‡∏™‡πà API Key ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á
      </div>
      <div class="demo-alert" id="demoAlert">
        ‚ö†Ô∏è ‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞ - ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏µ‡∏¢‡πå API ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á
      </div>
    </div>

    <div class="search-section">
      <div class="search-wrapper">
        <input
          type="text"
          id="tickerInput"
          placeholder="‡πÉ‡∏™‡πà‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏´‡∏∏‡πâ‡∏ô ‡πÄ‡∏ä‡πà‡∏ô AAPL, NVDA, TSLA"
          maxlength="10"
        />
        <button onclick="analyzeStock()">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</button>
      </div>
      <div class="quick-picks">
        <span class="quick-picks-label">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡πà‡∏ß‡∏ô:</span>
        <span onclick="quickPick('AAPL')">AAPL</span>
        <span onclick="quickPick('NVDA')">NVDA</span>
        <span onclick="quickPick('TSLA')">TSLA</span>
        <span onclick="quickPick('GOOGL')">GOOGL</span>
        <span onclick="quickPick('MSFT')">MSFT</span>
      </div>
    </div>

    <div class="features-section" id="featuresSection">
      <h3 style="color: #ffd700; margin-bottom: 20px; font-size: 1.2em;">‚ú® ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏Å</h3>
      <div class="features-grid">
        <div class="feature-item">
          <div class="feature-icon">üìä</div>
          <div class="feature-content">
            <div class="feature-title">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏° 100</div>
            <div class="feature-desc">‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô</div>
          </div>
        </div>
        <div class="feature-item">
          <div class="feature-icon">üí∞</div>
          <div class="feature-content">
            <div class="feature-title">7 ‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î</div>
            <div class="feature-desc">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ ‡∏Å‡∏≥‡πÑ‡∏£ ‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô ‡πÅ‡∏•‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡πÜ</div>
          </div>
        </div>
        <div class="feature-item">
          <div class="feature-icon">üéØ</div>
          <div class="feature-content">
            <div class="feature-title">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</div>
            <div class="feature-desc">‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏∏‡πâ‡∏ô</div>
          </div>
        </div>
        <div class="feature-item">
          <div class="feature-icon">‚ö°</div>
          <div class="feature-content">
            <div class="feature-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á</div>
            <div class="feature-desc">‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Finnhub API</div>
          </div>
        </div>
        <div class="feature-item">
          <div class="feature-icon">üìà</div>
          <div class="feature-content">
            <div class="feature-title">‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏£‡∏≤‡∏¢‡∏õ‡∏µ</div>
            <div class="feature-desc">‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á</div>
          </div>
        </div>
        <div class="feature-item">
          <div class="feature-icon">üîê</div>
          <div class="feature-content">
            <div class="feature-title">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</div>
            <div class="feature-desc">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°</div>
          </div>
        </div>
      </div>
    </div>

    <div class="loading" id="loading">
      <div class="loading-spinner"></div>
      <div class="loading-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô...</div>
    </div>

    <div class="error" id="error"></div>

    <div class="results-wrapper" id="resultsWrapper">
      <div class="result-header">
        <div class="result-symbol" id="resultSymbol">--</div>
        <div class="last-updated" id="lastUpdated">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: --</div>
      </div>

      <h2 class="section-title">üìä ‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</h2>
      <div class="cards-grid" id="metricsGrid"></div>

      <div class="overall-score-section">
        <div class="overall-score-content">
          <div class="score-label">‚≠ê ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°</div>
          <div class="score-container">
            <div class="score-circle" id="scoreCircle">
              <div>-</div>
              <div class="score-sub-label">/ 100</div>
            </div>
          </div>
          <div id="scoreBreakdown" class="score-breakdown"></div>
          <div id="scoreRecommendation" class="recommendation-section"></div>
        </div>
      </div>

      <div class="footer-note">
        <strong>‚ö†Ô∏è ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:</strong> ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏ô‡∏≠‡∏î‡∏µ‡∏ï ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏ó‡∏≥‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏≠‡∏î‡∏µ‡∏ï‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï ‡πÇ‡∏õ‡∏£‡∏î‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏µ‡πà‡∏ñ‡πâ‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏•‡∏á‡∏ó‡∏∏‡∏ô
      </div>
    </div>
  </div>

  <script>
    // ‚úÖ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ API Keys ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
    window.ALPHA_VANTAGE_API_KEY = 'SSHS1YDZEUU1VQM0';
    window.FINNHUB_API_KEY = 'd46ntu1r01qgc9etnfngd46ntu1r01qgc9etnfo0';

    const CONFIG = {
      CACHE_TTL_MS: 600000,
      USE_DEMO: true,
      API_SOURCE: 'demo',
    };

    function checkAPIKeys() {
      const hasAlphaVantage = !!window.ALPHA_VANTAGE_API_KEY;
      const hasFinnhub = !!window.FINNHUB_API_KEY;

      if (hasAlphaVantage) {
        CONFIG.USE_DEMO = false;
        CONFIG.API_SOURCE = 'alpha-vantage';
        document.getElementById('apiStatus').style.display = 'block';
        document.getElementById('apiInfo').style.display = 'none';
        document.getElementById('demoAlert').style.display = 'none';
        console.log('‚úÖ Alpha Vantage API Key detected');
      } else if (hasFinnhub) {
        CONFIG.USE_DEMO = false;
        CONFIG.API_SOURCE = 'finnhub';
        document.getElementById('apiStatus').style.display = 'block';
        document.getElementById('apiInfo').style.display = 'none';
        document.getElementById('demoAlert').style.display = 'none';
        console.log('‚úÖ Finnhub API Key detected');
      } else {
        CONFIG.USE_DEMO = true;
        CONFIG.API_SOURCE = 'demo';
        document.getElementById('apiStatus').style.display = 'none';
        document.getElementById('apiInfo').style.display = 'block';
        document.getElementById('demoAlert').style.display = 'block';
        console.log('üìä Using Demo Mode');
      }
    }

    function getCache(symbol) {
      try {
        const cached = localStorage.getItem(`fh_${symbol}`);
        if (!cached) return null;
        const { data, timestamp } = JSON.parse(cached);
        if (Date.now() - timestamp > CONFIG.CACHE_TTL_MS) {
          localStorage.removeItem(`fh_${symbol}`);
          return null;
        }
        return data;
      } catch (e) {
        return null;
      }
    }

    function setCache(symbol, data) {
      try {
        localStorage.setItem(`fh_${symbol}`, JSON.stringify({
          data,
          timestamp: Date.now(),
        }));
      } catch (e) {
        console.warn('Cache save failed:', e);
      }
    }

    function safeFloat(val) {
      const num = parseFloat(val);
      return isNaN(num) ? 0 : num;
    }

    async function fetchAlphaVantage(symbol) {
      const key = window.ALPHA_VANTAGE_API_KEY;
      if (!key) return null;

      try {
        console.log('üìä Fetching from Alpha Vantage:', symbol);
        const res = await fetch(
          `https://www.alphavantage.co/query?function=INCOME_STATEMENT&symbol=${symbol}&apikey=${key}`
        );
        const data = await res.json();

        if (data.Information || data.Error) {
          console.warn('Alpha Vantage error:', data.Information || data.Error);
          return null;
        }

        if (!data.annualReports || data.annualReports.length === 0) {
          console.warn('No annual reports found for', symbol);
          return null;
        }

        console.log('‚úÖ Alpha Vantage data received for:', symbol);
        return parseAlphaVantageData(symbol, data);
      } catch (e) {
        console.error('Alpha Vantage fetch error:', e);
        return null;
      }
    }

    async function fetchFinnhub(symbol) {
      const key = window.FINNHUB_API_KEY;
      if (!key) return null;

      try {
        console.log('üìä Fetching from Finnhub:', symbol);
        const [metricsRes, financialsRes] = await Promise.all([
          fetch(`https://finnhub.io/api/v1/stock/metric?symbol=${symbol}&metric=all&token=${key}`),
          fetch(`https://finnhub.io/api/v1/stock/financials-reported?symbol=${symbol}&token=${key}`),
        ]);

        const metrics = await metricsRes.json();
        const financials = await financialsRes.json();

        console.log('‚úÖ Finnhub data received for:', symbol);
        return parseFinnhubData(symbol, metrics, financials);
      } catch (e) {
        console.error('Finnhub fetch error:', e);
        return null;
      }
    }

    function parseAlphaVantageData(symbol, data) {
      const annual = data.annualReports || [];
      if (annual.length === 0) return null;

      const latest = annual[0];
      const previous = annual.length > 1 ? annual[1] : null;

      const latestRevenue = safeFloat(latest.totalRevenue);
      const latestNetIncome = safeFloat(latest.netIncome);
      const latestEBIT = safeFloat(latest.ebitda);
      const latestEPS = safeFloat(latest.eps);
      const latestOperatingIncome = safeFloat(latest.operatingIncome);
      const latestInterestExpense = safeFloat(latest.interestExpense);

      const prevRevenue = previous ? safeFloat(previous.totalRevenue) : 0;
      const prevNetIncome = previous ? safeFloat(previous.netIncome) : 0;
      const prevEPS = previous ? safeFloat(previous.eps) : 0;

      const revenueGrowth = prevRevenue > 0 
        ? ((latestRevenue - prevRevenue) / prevRevenue) * 100 
        : 0;

      const netIncomeGrowth = prevNetIncome !== 0
        ? ((latestNetIncome - prevNetIncome) / Math.abs(prevNetIncome)) * 100 
        : 0;

      const epsGrowth = prevEPS !== 0
        ? ((latestEPS - prevEPS) / Math.abs(prevEPS)) * 100 
        : 0;

      const profitMargin = latestRevenue > 0
        ? (latestNetIncome / latestRevenue) * 100
        : 0;

      let interestCoverage = null;
      const ebit = latestOperatingIncome > 0 ? latestOperatingIncome : latestEBIT;
      if (ebit > 0 && latestInterestExpense > 0) {
        interestCoverage = ebit / latestInterestExpense;
      }

      return {
        symbol,
        source: 'Alpha Vantage',
        revenueYoY: {
          value: latestRevenue,
          prevValue: prevRevenue,
          growth: revenueGrowth,
        },
        netIncomeYoY: {
          value: latestNetIncome,
          prevValue: prevNetIncome,
          growth: netIncomeGrowth,
        },
        eps: latestEPS,
        epsGrowth: epsGrowth,
        netMargin: profitMargin,
        profitMargin: profitMargin,
        debtToEquity: null,
        interestCoverage: interestCoverage,
        freeCashFlow: null,
      };
    }

    function parseFinnhubData(symbol, metrics, financials) {
      const metric = metrics.metric || {};
      const quarterly = financials.quarterly || [];

      let revenueTTM = safeFloat(metric.revenueTTM) || null;
      let netIncomeTTM = null;

      if (quarterly.length >= 4) {
        const last4 = quarterly.slice(0, 4);
        netIncomeTTM = last4.reduce((sum, q) => sum + (parseFloat(q.netIncome) || 0), 0);
      }

      return {
        symbol,
        source: 'Finnhub',
        revenueYoY: {
          value: revenueTTM,
          prevValue: null,
          growth: metric.revenueGrowth ? metric.revenueGrowth * 100 : null,
        },
        netIncomeYoY: {
          value: netIncomeTTM,
          prevValue: null,
          growth: metric.netIncomeGrowth ? metric.netIncomeGrowth * 100 : null,
        },
        eps: safeFloat(metric.epsBasicExclExtraItemsTTM) || safeFloat(metric.epsTTM) || null,
        epsGrowth: metric.epsgrowth ? metric.epsgrowth * 100 : null,
        netMargin: metric.netMargin ? metric.netMargin * 100 : null,
        profitMargin: metric.profitMargin ? metric.profitMargin * 100 : null,
        debtToEquity: metric.debtToEquity || null,
        interestCoverage: null,
        freeCashFlow: metric.freeCashFlowTTM || null,
      };
    }

    function generateDemoData(symbol) {
      const demoSymbols = {
        'AAPL': { revenue: 383285, netIncome: 96995, eps: 6.05, margin: 25.3, de: 0.58, fcf: 110543 },
        'NVDA': { revenue: 60922, netIncome: 24471, eps: 9.63, margin: 40.2, de: 0.42, fcf: 28718 },
        'TSLA': { revenue: 81462, netIncome: 13256, eps: 3.01, margin: 16.3, de: 0.90, fcf: 11497 },
        'GOOGL': { revenue: 307394, netIncome: 76033, eps: 6.03, margin: 24.7, de: 0.16, fcf: 74299 },
        'MSFT': { revenue: 245122, netIncome: 88188, eps: 11.73, margin: 36.0, de: 0.74, fcf: 63093 },
      };

      const base = demoSymbols[symbol.toUpperCase()] || {
        revenue: 100000 + Math.random() * 200000,
        netIncome: Math.random() * 30000,
        eps: 2 + Math.random() * 8,
        margin: 5 + Math.random() * 30,
        de: 0.3 + Math.random() * 1.5,
        fcf: 5000 + Math.random() * 50000,
      };

      return {
        symbol: symbol.toUpperCase(),
        source: 'Demo',
        revenueYoY: {
          value: base.revenue * 1e6,
          prevValue: base.revenue * 0.88e6,
        },
        netIncomeYoY: {
          value: base.netIncome * 1e6,
          prevValue: base.netIncome * 0.82e6,
        },
        eps: base.eps,
        epsGrowth: 8 + Math.random() * 10,
        netMargin: base.margin,
        debtToEquity: base.de,
        freeCashFlow: base.fcf * 1e6,
      };
    }

    function scoreRevenueYoY(data) {
      if (!data || !data.value || !data.prevValue) return { status: 'gray', reason: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö' };
      const growth = ((data.value - data.prevValue) / data.prevValue) * 100;
      if (growth >= 10) return { status: 'good', value: growth };
      if (growth >= 0) return { status: 'neutral', value: growth };
      return { status: 'poor', value: growth };
    }

    function scoreNetIncome(data) {
      if (!data || data.value === null) return { status: 'gray', reason: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö' };
      const isPositive = data.value > 0;
      const growth = data.prevValue
        ? ((data.value - data.prevValue) / Math.abs(data.prevValue)) * 100
        : (data.growth || 0);
      if (isPositive && growth >= 5) return { status: 'good', value: growth };
      if (isPositive && growth >= 0) return { status: 'neutral', value: growth };
      return { status: 'poor', value: growth };
    }

    function scoreEPSGrowth(growth) {
      if (growth === null || growth === undefined) return { status: 'gray', reason: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö' };
      if (growth >= 10) return { status: 'good', value: growth };
      if (growth >= 0) return { status: 'neutral', value: growth };
      return { status: 'poor', value: growth };
    }

    function scoreProfitMargin(margin) {
      if (margin === null || margin === undefined) return { status: 'gray', reason: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö' };
      if (margin >= 10) return { status: 'good', value: margin };
      if (margin >= 0) return { status: 'neutral', value: margin };
      return { status: 'poor', value: margin };
    }

    function scoreDebtToEquity(de) {
      if (de === null || de === undefined) return { status: 'gray', reason: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö' };
      if (de < 0.8) return { status: 'good', value: de };
      if (de < 1.5) return { status: 'neutral', value: de };
      return { status: 'poor', value: de };
    }

    function scoreInterestCoverage(coverage) {
      if (coverage === null || coverage === undefined) return { status: 'gray', reason: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö' };
      if (coverage >= 3) return { status: 'good', value: coverage };
      if (coverage >= 1) return { status: 'neutral', value: coverage };
      return { status: 'poor', value: coverage };
    }

    function scoreFreeCashFlow(data) {
      if (!data || data.value === null) return { status: 'gray', reason: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö' };
      const isPositive = data.value > 0;
      const growth = data.growth !== undefined ? data.growth : 0;
      if (isPositive && growth >= 5) return { status: 'good', value: data.value };
      if (isPositive && growth >= 0) return { status: 'neutral', value: data.value };
      return { status: 'poor', value: data.value };
    }

    function formatNumber(num) {
      if (num === null || num === undefined || isNaN(num)) return '‡πÑ‡∏°‡πà‡∏°‡∏µ';
      return Math.abs(num).toLocaleString('en-US', { maximumFractionDigits: 1 });
    }

    function formatCurrency(num) {
      if (num === null || num === undefined || isNaN(num)) return '‡πÑ‡∏°‡πà‡∏°‡∏µ';
      const abs = Math.abs(num);
      if (abs >= 1e9) return '$' + (abs / 1e9).toFixed(1) + 'B';
      if (abs >= 1e6) return '$' + (abs / 1e6).toFixed(1) + 'M';
      return '$' + abs.toFixed(0);
    }

    function formatPercent(num, decimals = 1) {
      if (num === null || num === undefined || isNaN(num)) return '‡πÑ‡∏°‡πà‡∏°‡∏µ';
      return (Math.round(num * (10 ** decimals)) / (10 ** decimals)).toFixed(decimals) + '%';
    }

    function renderCard(title, valueText, status, reason) {
      const statusColors = {
        good: 'status-good',
        neutral: 'status-neutral',
        poor: 'status-poor',
        gray: 'status-gray',
      };
      const statusLabels = {
        good: '‚úì',
        neutral: '~',
        poor: '‚úó',
        gray: '?',
      };
      return `
        <div class="metric-card">
          <div class="card-title">
            <span class="status-light ${statusColors[status]}">${statusLabels[status]}</span>
            ${title}
          </div>
          <div class="card-value">${valueText}</div>
          <div class="card-reason">${reason}</div>
        </div>
      `;
    }

    function calculateOverallScore(data) {
      let scores = [];
      let scoreDetails = [];

      // Revenue Growth Score (0-20 points)
      if (data.revenueYoY && data.revenueYoY.value && data.revenueYoY.prevValue) {
        const growth = ((data.revenueYoY.value - data.revenueYoY.prevValue) / data.revenueYoY.prevValue) * 100;
        let score = 0;
        if (growth >= 20) score = 20;
        else if (growth >= 10) score = 15;
        else if (growth >= 0) score = 10;
        else if (growth >= -10) score = 5;
        scores.push(score);
        scoreDetails.push({ name: '‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ YoY', value: score, max: 20 });
      }

      // Net Income Score (0-20 points)
      if (data.netIncomeYoY && data.netIncomeYoY.value !== null) {
        const isPositive = data.netIncomeYoY.value > 0;
        const growth = data.netIncomeYoY.prevValue
          ? ((data.netIncomeYoY.value - data.netIncomeYoY.prevValue) / Math.abs(data.netIncomeYoY.prevValue)) * 100
          : (data.netIncomeYoY.growth || 0);
        let score = 0;
        if (isPositive && growth >= 15) score = 20;
        else if (isPositive && growth >= 5) score = 15;
        else if (isPositive && growth >= 0) score = 10;
        else if (isPositive && growth >= -10) score = 5;
        scores.push(score);
        scoreDetails.push({ name: '‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥', value: score, max: 20 });
      }

      // EPS Growth Score (0-15 points)
      if (data.epsGrowth !== undefined && data.epsGrowth !== null) {
        let score = 0;
        if (data.epsGrowth >= 20) score = 15;
        else if (data.epsGrowth >= 10) score = 12;
        else if (data.epsGrowth >= 0) score = 8;
        else if (data.epsGrowth >= -10) score = 4;
        scores.push(score);
        scoreDetails.push({ name: '‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï EPS', value: score, max: 15 });
      }

      // Profit Margin Score (0-15 points)
      if (data.netMargin !== null && data.netMargin !== undefined) {
        let score = 0;
        if (data.netMargin >= 20) score = 15;
        else if (data.netMargin >= 10) score = 12;
        else if (data.netMargin >= 5) score = 8;
        else if (data.netMargin >= 0) score = 4;
        scores.push(score);
        scoreDetails.push({ name: '‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡πÑ‡∏£', value: score, max: 15 });
      }

      // Debt to Equity Score (0-15 points)
      if (data.debtToEquity !== null && data.debtToEquity !== undefined) {
        let score = 0;
        if (data.debtToEquity < 0.5) score = 15;
        else if (data.debtToEquity < 0.8) score = 12;
        else if (data.debtToEquity < 1.5) score = 8;
        else if (data.debtToEquity < 2.0) score = 4;
        scores.push(score);
        scoreDetails.push({ name: '‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô/‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏∏‡∏ô', value: score, max: 15 });
      }

      // Interest Coverage Score (0-10 points)
      if (data.interestCoverage !== null && data.interestCoverage !== undefined) {
        let score = 0;
        if (data.interestCoverage >= 5) score = 10;
        else if (data.interestCoverage >= 3) score = 8;
        else if (data.interestCoverage >= 1) score = 4;
        scores.push(score);
        scoreDetails.push({ name: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢', value: score, max: 10 });
      }

      // Free Cash Flow Score (0-5 points)
      if (data.freeCashFlow !== null && data.freeCashFlow !== undefined) {
        let score = 0;
        if (data.freeCashFlow > 0) score = 5;
        scores.push(score);
        scoreDetails.push({ name: '‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î', value: score, max: 5 });
      }

      const totalScore = scores.length > 0 ? Math.round((scores.reduce((a, b) => a + b, 0) / (20 + 20 + 15 + 15 + 15 + 10 + 5)) * 100) : 0;
      return { totalScore, scoreDetails };
    }

    function getHealthCategory(score) {
      if (score >= 80) return { category: 'excellent', label: '‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°', color: 'score-excellent' };
      if (score >= 60) return { category: 'good', label: '‡∏î‡∏µ', color: 'score-good' };
      if (score >= 40) return { category: 'average', label: '‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á', color: 'score-average' };
      return { category: 'poor', label: '‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á', color: 'score-poor' };
    }

    function getScoreRecommendation(score, data) {
      const health = getHealthCategory(score);
      let recommendation = '';
      let details = [];

      if (score >= 80) {
        recommendation = `üéØ ‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°! ‡∏´‡∏∏‡πâ‡∏ô ${data.symbol} ‡∏°‡∏µ<strong>‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏Å‡∏£‡πà‡∏á</strong> ‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏ó‡∏µ‡πà‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á ‡∏Å‡∏≥‡πÑ‡∏£‡∏î‡∏µ ‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏ï‡πà‡∏≥`;
        details = [
          '‚úÖ ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏Å‡∏£‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏ó‡∏µ‡πà‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á',
          '‚úÖ ‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏ï‡πà‡∏≥‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û',
          'üí° ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏ß‡∏Å‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á'
        ];
      } else if (score >= 60) {
        recommendation = `üëç ‡∏î‡∏µ! ‡∏´‡∏∏‡πâ‡∏ô ${data.symbol} ‡∏°‡∏µ<strong>‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ</strong> ‡πÅ‡∏ï‡πà‡∏°‡∏µ‡∏ö‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÑ‡∏î‡πâ`;
        details = [
          '‚úÖ ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô‡∏ô‡πà‡∏≤‡∏û‡∏≠‡πÉ‡∏à‡πÇ‡∏î‡∏¢‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ',
          '‚ö†Ô∏è ‡∏°‡∏µ‡∏ö‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°',
          'üí° ‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏ö‡∏Å‡∏û‡∏£‡πà‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï'
        ];
      } else if (score >= 40) {
        recommendation = `‚ö†Ô∏è ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á! ‡∏´‡∏∏‡πâ‡∏ô ${data.symbol} ‡∏°‡∏µ<strong>‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πà‡∏≠‡∏™‡∏≤‡∏¢‡∏ö‡πâ‡∏≤‡∏á</strong> ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏•‡∏∂‡∏Å‡∏ï‡πà‡∏≠‡πÑ‡∏õ`;
        details = [
          '‚ö†Ô∏è ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢‡πÉ‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Å‡∏≥‡πÑ‡∏£',
          'üìä ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏Å‡∏•‡πâ‡∏ä‡∏¥‡∏î',
          'üí° ‡∏•‡∏≠‡∏á‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏Ç‡∏≠‡∏á‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏•‡∏á‡∏ó‡∏∏‡∏ô'
        ];
      } else {
        recommendation = `üî¥ ‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á! ‡∏´‡∏∏‡πâ‡∏ô ${data.symbol} ‡∏°‡∏µ<strong>‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏≠</strong> ‡∏ã‡∏∂‡πà‡∏á‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á`;
        details = [
          '‚ùå ‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏°‡∏≤‡∏Å‡πÉ‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô',
          '‚ö†Ô∏è ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á - ‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç',
          'üí° ‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏≠‡∏ö‡∏Ñ‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏•‡∏á‡∏ó‡∏∏‡∏ô'
        ];
      }

      return { recommendation, details, health };
    }

    async function analyzeStock() {
      const ticker = document.getElementById('tickerInput').value.trim().toUpperCase();
      if (!ticker) {
        showError('‡πÇ‡∏õ‡∏£‡∏î‡πÉ‡∏™‡πà‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏´‡∏∏‡πâ‡∏ô');
        return;
      }

      const cached = getCache(ticker);
      if (cached) {
        displayResults(cached);
        return;
      }

      showLoading(true);
      hideError();

      try {
        let data = null;

        if (CONFIG.USE_DEMO) {
          data = generateDemoData(ticker);
        } else if (CONFIG.API_SOURCE === 'alpha-vantage') {
          data = await fetchAlphaVantage(ticker);
        } else if (CONFIG.API_SOURCE === 'finnhub') {
          data = await fetchFinnhub(ticker);
        }

        if (!data) {
          throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ' + ticker + ' ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏´‡∏∏‡πâ‡∏ô');
        }

        setCache(ticker, data);
        displayResults(data);
      } catch (error) {
        showError(error.message);
      } finally {
        showLoading(false);
      }
    }

    function displayResults(data) {
      const symbol = data.symbol;
      document.getElementById('resultSymbol').textContent = symbol;
      document.getElementById('lastUpdated').textContent = '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ' + new Date().toLocaleString('th-TH') + ' (' + (data.source || 'Demo') + ')';

      const revenueScore = scoreRevenueYoY(data.revenueYoY);
      const netIncomeScore = scoreNetIncome(data.netIncomeYoY);
      const epsScore = scoreEPSGrowth(data.epsGrowth !== undefined ? data.epsGrowth : 0);
      const marginScore = scoreProfitMargin(data.netMargin);
      const deScore = scoreDebtToEquity(data.debtToEquity);
      const interestScore = scoreInterestCoverage(data.interestCoverage);
      const fcfScore = scoreFreeCashFlow(data.freeCashFlow);

      let html = '';

      if (revenueScore.status !== 'gray') {
        const growth = revenueScore.value;
        const v1 = formatCurrency(data.revenueYoY.value);
        const v2 = formatCurrency(data.revenueYoY.prevValue);
        const reason = `‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï ${growth >= 0 ? '+' : ''}${formatPercent(growth)} ‡∏õ‡∏µ‡∏ï‡πà‡∏≠‡∏õ‡∏µ (${v2} ‚Üí ${v1})`;
        html += renderCard('‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ YoY', formatPercent(growth), revenueScore.status, reason);
      } else {
        html += renderCard('‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ YoY', '‡πÑ‡∏°‡πà‡∏°‡∏µ', 'gray', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÑ‡∏°‡πà‡∏û‡∏ö');
      }

      if (netIncomeScore.status !== 'gray') {
        const growth = netIncomeScore.value;
        const v1 = formatCurrency(data.netIncomeYoY.value);
        const status = data.netIncomeYoY.value > 0 ? netIncomeScore.status : 'poor';
        const reason = `‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ ${growth >= 0 ? '+' : ''}${formatPercent(growth)} ‡∏õ‡∏µ‡∏ï‡πà‡∏≠‡∏õ‡∏µ ‚Ä¢ ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤: ${v1}`;
        html += renderCard('‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ (TTM)', formatPercent(growth), status, reason);
      } else {
        html += renderCard('‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ (TTM)', '‡πÑ‡∏°‡πà‡∏°‡∏µ', 'gray', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡πÑ‡∏°‡πà‡∏û‡∏ö');
      }

      if (epsScore.status !== 'gray') {
        const growth = epsScore.value;
        const eps = data.eps !== null ? data.eps.toFixed(2) : '‡πÑ‡∏°‡πà‡∏°‡∏µ';
        const reason = `‡∏Å‡∏≥‡πÑ‡∏£‡∏ï‡πà‡∏≠‡∏´‡∏∏‡πâ‡∏ô ‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï ${growth >= 0 ? '+' : ''}${formatPercent(growth)} ‡∏õ‡∏µ‡∏ï‡πà‡∏≠‡∏õ‡∏µ ‚Ä¢ EPS: $${eps}`;
        html += renderCard('‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï EPS', formatPercent(growth), epsScore.status, reason);
      } else {
        html += renderCard('‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï EPS', '‡πÑ‡∏°‡πà‡∏°‡∏µ', 'gray', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï EPS ‡πÑ‡∏°‡πà‡∏û‡∏ö');
      }

      if (marginScore.status !== 'gray') {
        const margin = marginScore.value;
        const profitStatus = margin >= 10 ? '‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏î‡∏µ' : margin >= 0 ? '‡∏Å‡∏≥‡πÑ‡∏£‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á' : '‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ breakeven';
        const reason = `‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡∏ó‡∏µ‡πà ${formatPercent(margin)} ‚Ä¢ ${profitStatus}`;
        html += renderCard('‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡πÑ‡∏£ (TTM)', formatPercent(margin), marginScore.status, reason);
      } else {
        html += renderCard('‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡πÑ‡∏£ (TTM)', '‡πÑ‡∏°‡πà‡∏°‡∏µ', 'gray', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡πÑ‡∏£‡πÑ‡∏°‡πà‡∏û‡∏ö');
      }

      if (deScore.status !== 'gray') {
        const de = deScore.value.toFixed(2);
        const statusMsg = data.debtToEquity < 0.8 ? 'Leverage ‡∏≠‡∏ô‡∏∏‡∏£‡∏±‡∏Å‡∏©‡πå‡∏ô‡∏¥‡∏¢‡∏°' : data.debtToEquity < 1.5 ? 'Leverage ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á' : 'Leverage ‡∏™‡∏π‡∏á';
        const reason = `‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô D/E ${de} ‚Ä¢ ${statusMsg}`;
        html += renderCard('‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô/‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏ñ‡∏∑‡∏≠‡∏´‡∏∏‡πâ‡∏ô', de, deScore.status, reason);
      } else {
        html += renderCard('‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô/‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏ñ‡∏∑‡∏≠‡∏´‡∏∏‡πâ‡∏ô', '‡πÑ‡∏°‡πà‡∏°‡∏µ', 'gray', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏ö‡∏î‡∏∏‡∏•‡πÑ‡∏°‡πà‡∏û‡∏ö');
      }

      if (interestScore.status !== 'gray') {
        const coverage = data.interestCoverage.toFixed(2);
        const statusMsg = data.interestCoverage >= 3 ? '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏™‡∏π‡∏á' : data.interestCoverage >= 1 ? '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á' : '‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á';
        const reason = `‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢ ${coverage}x ‚Ä¢ ${statusMsg}`;
        html += renderCard('‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢', coverage + 'x', interestScore.status, reason);
      } else {
        html += renderCard('‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢', '‡πÑ‡∏°‡πà‡∏°‡∏µ', 'gray', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÑ‡∏°‡πà‡∏û‡∏ö');
      }

      if (fcfScore.status !== 'gray') {
        const fcf = formatCurrency(data.freeCashFlow);
        const statusMsg = data.freeCashFlow > 0 ? '‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á FCF ‡∏ö‡∏ß‡∏Å' : 'FCF ‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏ö';
        const reason = `‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏≠‡∏¥‡∏™‡∏£‡∏∞: ${fcf} (TTM) ‚Ä¢ ${statusMsg}`;
        html += renderCard('‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏≠‡∏¥‡∏™‡∏£‡∏∞ (TTM)', fcf, fcfScore.status, reason);
      } else {
        html += renderCard('‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏≠‡∏¥‡∏™‡∏£‡∏∞ (TTM)', '‡πÑ‡∏°‡πà‡∏°‡∏µ', 'gray', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏ö‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡πÑ‡∏°‡πà‡∏û‡∏ö');
      }

      document.getElementById('metricsGrid').innerHTML = html;
      document.getElementById('resultsWrapper').style.display = 'block';

      // Calculate and display overall score
      const scoreData = calculateOverallScore(data);
      const totalScore = scoreData.totalScore;
      const health = getHealthCategory(totalScore);
      const { recommendation, details } = getScoreRecommendation(totalScore, data);

      // Update score circle
      const scoreCircle = document.getElementById('scoreCircle');
      scoreCircle.className = `score-circle ${health.color}`;
      scoreCircle.innerHTML = `<div>${totalScore}</div><div class="score-sub-label">/ 100</div>`;

      // Update score breakdown
      const breakdownHTML = scoreData.scoreDetails
        .map(item => `
          <div class="score-item">
            <span class="score-item-name">${item.name}</span>
            <span class="score-item-value">${item.value}/${item.max}</span>
          </div>
        `)
        .join('');
      document.getElementById('scoreBreakdown').innerHTML = breakdownHTML;

      // Update recommendation
      const recommendationHTML = `
        <div class="recommendation-title">üí° ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</div>
        <div class="recommendation-text">${recommendation}</div>
        <div style="margin-top: 15px;">
          ${details.map(detail => `<div style="margin-bottom: 8px;">${detail}</div>`).join('')}
        </div>
        <div style="margin-top: 15px;">
          <span class="health-badge ${health.category}">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${health.label}</span>
        </div>
      `;
      document.getElementById('scoreRecommendation').innerHTML = recommendationHTML;
    }

    function showLoading(show) {
      document.getElementById('loading').style.display = show ? 'block' : 'none';
    }

    function showError(msg) {
      const errorEl = document.getElementById('error');
      errorEl.textContent = msg;
      errorEl.style.display = 'block';
    }

    function hideError() {
      document.getElementById('error').style.display = 'none';
    }

    function quickPick(ticker) {
      document.getElementById('tickerInput').value = ticker;
      analyzeStock();
    }

    document.getElementById('tickerInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        analyzeStock();
      }
    });

    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
    checkAPIKeys();
    document.getElementById('featuresSection').classList.add('show');
  </script>
</body>
</html>
